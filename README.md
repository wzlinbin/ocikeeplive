# ocikeeplive
OCI免费机器保活脚本
这个针对 OCI（甲骨文云）优化的 Python 脚本是一个自适应资源调控器。它通过实时监控系统负载，在 CPU 闲置时自动补齐功耗，在业务繁忙时主动退避，从而确保实例因“活跃度达标”而不被回收，同时不干扰你的真实业务。

1. 核心机制 (How it works)
脚本模拟了一个闭环反馈控制系统，其逻辑类似于工业领域的 PID 控制器：

实时感知：通过 psutil 每隔 1.5 秒采样一次全系统的 CPU 占用率和内存剩余水位。

动态对冲：

计算差值：误差 = 目标值(约50%) - 当前实际值。

反馈调节：如果实际占用低（如 10%），脚本会通过 PID 算法调大自身 worker 线程的 load_factor（负载因子）。

资源脉冲：在计算循环中，脚本并不是单纯的死循环，而是采用 计算 -> 随机读写内存 -> 睡眠 的交替模式。

多维保护：

CPU 熔断：一旦总占用 > 75%，脚本进入 Active = False 的休眠状态。

内存熔断：一旦系统剩余内存 < 10%，脚本停止工作，确保不触发 OOM 崩溃。

作用总结 (Summary of Purpose)
防回收安全垫：通过维持 50% 的 CPU 占用，确保实例满足 OCI 的活跃度考核指标，保护永久免费资源。

业务伴生器：它像一个“影子”业务。当你的 Web 服务器或数据库请求量减少时，它浮现出来填补空白；当请求量激增时，它自动消失，不增加任何系统负担。

硬件活跃模拟：不仅是 CPU 运算，还通过对小内存块的频繁读写，触发内存控制器和缓存的活跃，使实例在底层监控中表现为“繁忙的生产机器”。

=============================================================================================================================================
如何执行

赋予权限： chmod +x install_guardian.sh

运行安装： sudo ./install_guardian.sh

后续管理
查看运行情况：使用 htop 查看，你会发现 Python 进程的优先级（NI列）为 19，且 CPU 总占用会慢慢向 50% 靠拢。

卸载：如果不需要了，运行 sudo systemctl stop oci-guardian && sudo systemctl disable oci-guardian 即可。
